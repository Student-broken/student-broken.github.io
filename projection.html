<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur Dynamique V10 (Pathfinder V2)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
:root{--primary-color:#5B21B6;--secondary-color:#059669;--warning-color:#F59E0B;--danger-color:#DC2626;--bg-color:#f9fafb;--transition-duration:0.3s}
body, .side-panel, .tab-content, .modal-content, .tab-btn, select, input, .score-card, .prediction-card, .ai-insight-box, .subject-table, .help-btn, .back-to-main-btn, .gauge-needle, .bg-violet-100 {
    transition: background-color var(--transition-duration) ease, color var(--transition-duration) ease, border-color var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
}
body{font-family:'Inter',sans-serif;background-color:var(--bg-color);color:#1f2937}.main-container{display:flex;min-height:100vh}.side-panel{width:100%;max-width:380px;background-color:white;padding:1.5rem;box-shadow:0 4px 16px rgba(0,0,0,.1);border-radius:.75rem;margin:1rem;height:fit-content}@media (max-width:1024px){.main-container{flex-direction:column}.side-panel{max-width:100%}}.content-area{flex-grow:1;padding:1rem}.tab-btn{padding:.75rem 1.5rem;font-weight:600;border-radius:.375rem .375rem 0 0;border-bottom:2px solid transparent;cursor:pointer;transition:all .2s;background-color:#eef2ff;color:#4c1d95;margin-right:.25rem}.tab-btn.active{background-color:white;border-bottom:2px solid var(--primary-color);color:var(--primary-color);box-shadow:0 -2px 6px rgba(0,0,0,.05)}.tab-content{background-color:white;padding:1.5rem;border-radius:0 .75rem .75rem .75rem;box-shadow:0 4px 16px rgba(0,0,0,.08)}.tab-content:not(.active){display:none}.subject-table{width:100%;border-collapse:collapse;margin-top:1.5rem;box-shadow:0 1px 4px rgba(0,0,0,.08);border-radius:.5rem;overflow:hidden;margin-bottom:1.5rem}.subject-table thead th{padding:.75rem;text-align:left;background-color:var(--primary-color);color:white;font-weight:700}.subject-table thead tr:first-child th{font-size:1.125rem;text-align:center}.subject-table tbody tr:nth-child(even){background-color:#f3f4f6}.subject-table td{padding:.5rem .75rem;border-bottom:1px solid #e5e7eb}.grade-percentage{font-weight:700;color:var(--primary-color)}.subject-analysis{background-color:#f5f3ff;border:1px solid #e9d5ff;padding:1rem;border-radius:.5rem;margin-top:-1rem;margin-bottom:1.5rem}.analysis-badge{display:inline-flex;align-items:center;padding:.25rem .75rem;border-radius:9999px;font-size:.875rem;font-weight:600;margin-right:.5rem}.badge-green{background-color:#D1FAE5;color:#065F46}.badge-yellow{background-color:#FEF3C7;color:#92400E}.badge-red{background-color:#FEE2E2;color:#991B1B}.badge-violet{background-color:#E9D5FF;color:#5B21B6}.badge-blue{background-color:#DBEAFE;color:#1E40AF}.badge-orange{background-color:#FFEDD5;color:#C2410C}.prediction-card{background-color:#f7f7f7;padding:1rem;border-radius:.5rem;border-left:5px solid;margin-bottom:1rem;transition:all .2s;box-shadow:0 1px 3px rgba(0,0,0,.05)}.card-green{border-left-color:var(--secondary-color)}.card-violet{border-left-color:var(--primary-color)}.card-yellow{border-left-color:var(--warning-color)}.card-red{border-left-color:var(--danger-color)}.card-score{font-size:1.875rem;font-weight:800;margin-top:.25rem}.probability-table th,.probability-table td{padding:.5rem;text-align:center;border:1px solid #e5e7eb}.prob-high{background-color:#D1FAE5;color:#065F46;font-weight:700}.prob-medium{background-color:#FEF3C7;color:#92400E}.prob-low{background-color:#FEE2E2;color:#991B1B}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:1000;transition:opacity .3s ease-out;opacity:0;pointer-events:none}.modal.active{opacity:1;pointer-events:auto}.modal-content{background:white;padding:2rem;border-radius:.75rem;box-shadow:0 10px 15px rgba(0,0,0,.1);max-width:90%;width:500px}.score-card{display:flex;align-items:center;padding:.75rem;border-radius:.5rem;background-color:#f3f4f6;transition:all .15s}.score-card strong{font-size:1.5rem}.score-icon{font-size:1.5rem;margin-right:1rem}.effort-needed{font-size:1.25rem;font-weight:700}.slider-label{font-weight:600;margin-top:1rem}.ai-insight-box{background-color:#f5f3ff;border:1px solid #ddd6fe;border-radius:.5rem;padding:1rem;margin-top:.75rem}.ai-insight-box h4{display:flex;align-items:center;font-size:1rem;font-weight:700;color:var(--primary-color);margin-bottom:.75rem}.ai-insight-box h4 span{font-size:1.25rem;margin-right:.5rem}.ai-insight-box ul{list-style-type:none;padding-left:0;font-size:.875rem}.ai-insight-box li{position:relative;padding-left:1.5rem;margin-bottom:.5rem;color:#374151;line-height:1.4}.ai-insight-box li::before{content:'‚ö†Ô∏è';font-size:.75rem;position:absolute;left:0;top:4px}.ai-insight-box li.insight-good::before{content:'‚úÖ'}.ai-insight-box li.insight-info::before{content:'‚ÑπÔ∏è'}.ai-insight-box li.insight-trend::before{content:'üìà'}.ai-insight-box li.insight-focus::before{content:'üéØ'}.ai-insight-box li.insight-priority::before{content:'üß†'}.ai-insight-box li.insight-erratic::before{content:'‚ö°'}.gauge-container{width:100%;padding:.5rem 0;margin-top:.5rem;margin-bottom:1rem}.gauge-bar{width:100%;height:12px;background:linear-gradient(90deg,var(--danger-color),var(--warning-color),var(--secondary-color));border-radius:6px;position:relative;box-shadow:inset 0 1px 3px rgba(0,0,0,.1)}.gauge-needle{position:absolute;top:-4px;width:4px;height:20px;background-color:#1f2937;border-radius:2px;border:1px solid white;box-shadow:0 0 5px rgba(0,0,0,.5);transform:translateX(-50%);transition:left .5s ease-out}.gauge-labels{display:flex;justify-content:space-between;font-size:.75rem;font-weight:600;color:#4b5563;margin-top:.5rem}.help-btn{position:fixed;top:10px;right:10px;width:30px;height:30px;background-color:#000000;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.1rem;text-decoration:none;box-shadow:0 4px 10px rgba(0,0,0,.2);z-index:999;cursor:pointer;transition:all .2s ease-in-out}.help-btn:hover{transform:translateY(-2px) scale(1.05);box-shadow:0 6px 15px rgba(0,0,0,.3);background-color:#6D28D9}#help-modal .modal-content{width:750px;max-width:95%;max-height:90vh;overflow-y:auto;text-align:left}.help-title{font-size:1.5rem;font-weight:700;color:var(--primary-color);margin-bottom:1rem;text-align:left}.help-section-title{font-size:1.25rem;font-weight:600;color:var(--primary-color);margin-top:1.5rem;border-bottom:2px solid var(--primary-color);padding-bottom:4px;margin-bottom:1rem}#help-modal h4{font-size:1.0rem;font-weight:700;color:#1f2937;margin-top:1.25rem;margin-bottom:.25rem}#help-modal p,#help-modal li{font-size:.95rem;color:#374151;line-height:1.6;margin-top:.5rem}#help-modal ul{list-style-type:disc;padding-left:2rem;margin-top:.5rem;margin-bottom:1rem}#help-modal ol.detailed-list{list-style-type:decimal;padding-left:1.5rem}#help-modal ol.detailed-list>li{font-weight:600;color:#1f2937;margin-top:1rem}#help-modal ol.detailed-list>li>ul{margin-top:.25rem;font-weight:normal}#help-modal b{font-weight:600;color:#1f2937}#help-modal .modal-close{position:absolute;top:10px;right:1button5px;font-size:2em;cursor:pointer;color:#aaa;line-height:1;z-index:1001}.back-to-main-btn{position:fixed;top:10px;left:30px;width:20px;height:20px;background-color:var(--primary-color);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.0rem;text-decoration:none;box-shadow:0 4px 10px rgba(0,0,0,.2);z-index:999;transition:all .2s ease-in-out}.back-to-main-btn:hover{transform:translateY(-2px) scale(1.05);box-shadow:0 6px 15px rgba(0,0,0,.3);background-color:#6D28D9}

[data-theme="dark"] {
    --bg-color: #121212;
    body, .content-area h1, .side-panel h2, .side-panel h3, .text-gray-800, .text-gray-700, .text-gray-600, .text-gray-500, .modal-content h3, .modal-content p, .ai-insight-box li, .text-sm, .text-base, .text-lg, .text-xl, .text-2xl, .text-3xl, .text-4xl, p, span, strong, div, button, label, select, th, td {
        color: #e0e0e0;
    }
    .text-gray-500, .text-xs, .text-sm.font-medium.text-gray-500, .gauge-labels span, .text-sm.text-gray-600 {
        color: #a0a0a0;
    }
    .gauge-needle {
        background-color: #e0e0e0;
        border-color: #121212;
    }
    .text-primary-color, .text-violet-700, .ai-insight-box h4, #gauge-label-p50, .grade-percentage, #help-modal .help-title, #help-modal .help-section-title {
        color: var(--primary-color);
    }
    .text-red-600 { color: var(--danger-color); }
    .text-orange-600 { color: var(--warning-color); }
    
    .side-panel, .tab-content, .modal-content, .subject-table tbody tr {
        background-color: #1e1e1e;
    }
    .subject-table tbody tr:nth-child(even), .score-card, .prediction-card {
        background-color: #2a2a2a;
    }
    .tab-btn {
        background-color: #2a2a2a;
        color: #a0a0a0;
    }
    .tab-btn.active {
        background-color: #1e1e1e;
        color: var(--primary-color);
    }
    .subject-table td, .side-panel h2, .side-panel h3, .content-area h1, .flex.border-b, .probability-table th, .probability-table td, .ai-insight-box, .subject-analysis, .modal-content, #unites-list, .border-t, .border-b, .border-l-4 {
        border-color: #333333;
    }
    .subject-analysis {
        background-color: #2a2a2a;
    }
    .ai-insight-box {
         background-color: #2a2a2a;
         border-color: #4a2c7a;
    }
    .bg-violet-100 {
        background-color: #2a2a2a;
        border-color: var(--primary-color);
    }
    select, input[type="range"] {
        background-color: #2a2a2a;
        color: #e0e0e0;
        border-color: #444;
    }
    #help-modal .modal-content {
        background: #1e1e1e;
    }
    #help-modal h4, #help-modal b {
         color: #e5e5e5;
    }
     #help-modal p, #help-modal li {
         color: #b0b0b0;
     }
     #unites-modal .modal-content {
         background: #1e1e1e;
     }
     #unites-list {
         border-color: #333;
     }
    .help-btn, .back-to-main-btn {
        background-color: #333;
        color: #e0e0e0;
    }
    .help-btn:hover, .back-to-main-btn:hover {
        background-color: var(--primary-color);
    }
    #unites-btn {
        background-color: #444;
        color: #e0e0e0;
    }
    #unites-btn:hover {
        background-color: #555;
    }
    .badge-green { background-color: #1a3e2a; color: #D1FAE5; }
    .badge-yellow { background-color: #4d381c; color: #FEF3C7; }
    .badge-red { background-color: #4f2323; color: #FEE2E2; }
    .badge-violet { background-color: #3a226d; color: #E9D5FF; }
    .badge-blue { background-color: #1e3a8a; color: #DBEAFE; }
    .badge-orange { background-color: #612c0a; color: #FFEDD5; }

    /* === FIXES START HERE === */

    /* 1. Fix for bright probability table rows */
    .prob-high { background-color: #1a3e2a !important; color: #D1FAE5 !important; }
    .prob-medium { background-color: #4d381c !important; color: #FEF3C7 !important; }
    .prob-low { background-color: #4f2323 !important; color: #FEE2E2 !important; }

    /* 2. Fix for bright table headers (which use Tailwind 'bg-gray-100') */
    .bg-gray-100 { background-color: #3a3a3a; }

    /* 3. NEW: Fix backgrounds for Mismatch cards (but DON'T touch their borders) */
    #mismatch-analysis > div {
        background-color: #2a2a2a !important;
        /* By not specifying a border-color here, the original classes 
           like .card-red and .card-yellow will apply correctly. */
    }

    /* 4. NEW: Fix backgrounds AND borders for the *other* Prediction cards */
    #global-predictions > div, 
    #subject-predictions-list > div {
        background-color: #2a2a2a !important;
        border-top: 1px solid #333333 !important;
        border-right: 1px solid #333333 !important;
        border-bottom: 1px solid #333333 !important;
        border-left-width: 5px !important;
        border-left-style: solid !important;
        border-left-color: #333333 !important; /* Default dark grey border */
    }
    
    /* 5. NEW: Apply specific colors ONLY to the *other* Prediction cards */
    #global-predictions > div.card-green, 
    #subject-predictions-list > div.card-green { 
        border-left-color: var(--secondary-color) !important; 
    }
    #global-predictions > div.card-violet, 
    #subject-predictions-list > div.card-violet { 
        border-left-color: var(--primary-color) !important; 
    }
    #global-predictions > div.card-yellow, 
    #subject-predictions-list > div.card-yellow { 
        border-left-color: var(--warning-color) !important; 
    }
    #global-predictions > div.card-red, 
    #subject-predictions-list > div.card-red { 
        border-left-color: var(--danger-color) !important; 
    }
    /* === FIXES END HERE === */
}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<a id="open-help-btn" class="help-btn" title="Comment √ßa marche ?">
    <i class="fa-solid fa-question"></i>
</a>

<button id="theme-toggle" class="help-btn" title="Changer de th√®me" style="right: 50px;">
    <i class="fa-solid fa-moon"></i>
</button>

<div id="help-modal" class="modal">
    <div class="modal-content">
        <span id="close-help-modal" class="modal-close">&times;</span>
        <h2 class="help-title">Guide D√©taill√© de l'Analyseur</h2>
        
        <p>Cet outil analyse votre <b>tendance</b> (votre "√©lan") et votre <b>volatilit√©</b> (votre stabilit√©) pour pr√©dire vos performances. Voici ce que chaque terme signifie en d√©tail.</p>

        <h3 class="help-section-title">Section Sp√©ciale : La R√©gression Lin√©aire (Le C≈ìur de l'IA)</h3>
        
        <h4>Qu'est-ce que c'est ?</h4>
        <p>Le "Moteur de D√©couverte (IA)" utilise un outil statistique appel√© <b>R√©gression Lin√©aire</b>. Son but est de trouver la "ligne de tendance" (la ligne droite de meilleur ajustement) qui passe au milieu d'un nuage de points de donn√©es. 

</p>
        <p>L'IA n'analyse pas seulement vos notes, elle analyse la <b>relation</b> entre deux variables. L'application effectue 3 analyses de r√©gression distinctes :</p>
        
        <ol class="detailed-list">
            <li><b>Mod√®le 1 : TENDANCE (Note vs. Temps)</b>
                <ul>
                    <li><b>(Axe X) :</b> Le temps (Devoir 1, Devoir 2, Devoir 3...)</li>
                    <li><b>(Axe Y) :</b> La note obtenue (85%, 88%, 87%...)</li>
                    <li><b>Ce qu'elle cherche :</b> "Est-ce que vos notes <b>montent</b> ou <b>baissent</b> avec le temps ?" C'est votre √©lan, ou "pente". C'est ce qui alimente le "Facteur de Tendance Globale".</li>
                </ul>
            </li>
            <li><b>Mod√®le 2 : FOCUS (Note vs. Pond√©ration du Devoir)</b>
                <ul>
                    <li><b>(Axe X) :</b> L'importance du devoir (Ex: 5%, 10%, 40%...)</li>
                    <li><b>(Axe Y) :</b> La note obtenue (95%, 90%, 82%...)</li>
                    <li><b>Ce qu'elle cherche :</b> "Avez-vous tendance √† mieux r√©ussir les <b>petits devoirs</b> ou les <b>gros examens</b> ?" Une pente n√©gative ici est un signal d'alarme : cela signifie que plus un examen est important, plus votre note a tendance √† baisser.</li>
                </ul>
            </li>
            <li><b>Mod√®le 3 : PRIORIT√â (Note vs. Pond√©ration de la Comp√©tence)</b>
                <ul>
                    <li><b>(Axe X) :</b> L'importance de la comp√©tence (Ex: 30%, 40%, 60%...)</li>
                    <li><b>(Axe Y) :</b> La note obtenue dans cette comp√©tence (90%, 85%, 80%...)</li>
                    <li><b>Ce qu'elle cherche :</b> "√ätes-vous meilleur dans les comp√©tences mineures ou majeures ?"</li>
                </ul>
            </li>
        </ol>

        <h4>Ce qui INFLUENCE la R√©gression (Votre question)</h4>
        <p>La "ligne de tendance" est comme une balan√ßoire. Ce qui l'influence le plus, ce sont les <b>points aberrants (Outliers)</b> et la <b>dispersion</b> de vos notes.</p>
        <ul>
            <li><b>Les Points Aberrants (Outliers) :</b> C'est l'influence n¬∞1. Si vous avez une moyenne de 90% mais que vous tombez malade et obtenez <b>20%</b> √† un examen, ce seul point tirera la "ligne de tendance" <b>massivement</b> vers le bas. L'IA verra cela comme une forte tendance n√©gative. De m√™me, un 100% facile sur un devoir tirera la ligne vers le haut.</li>
            <li><b>La Fiabilit√© (Le R¬≤) :</b> C'est le "Niveau de Confiance" de l'IA. C'est la statistique la plus importante que l'IA regarde.
                <ul>
                    <li>Un <b>R¬≤ √©lev√© (ex: 0.8 ou 80%)</b> signifie que vos notes sont tr√®s proches de la ligne de tendance. Le sch√©ma est <b>fiable</b>. L'IA peut affirmer avec certitude "Vous √™tes en hausse".</li>
                    <li>Un <b>R¬≤ faible (ex: 0.1 ou 10%)</b> signifie que vos notes sont "erratiques" et totalement dispers√©es autour de la ligne. Le sch√©ma est <b>non fiable</b>. C'est √† ce moment que l'IA vous dit : <b>"Je n'ai trouv√© aucun sch√©ma fiable"</b>, car la tendance qu'elle a trouv√©e n'explique que 10% de vos r√©sultats.</li>
                </ul>
            </li>
            <li><b>Le Nombre de Points (N) :</b> Une tendance sur 3 devoirs ne veut rien dire. Une tendance sur 30 devoirs est un sch√©ma tr√®s fort. C'est pourquoi l'IA ignore les mati√®res avec moins de 5 notes.</li>
        </ul>

        <h3 class="help-section-title">Panneau Principal (Gauche)</h3>
        
        <h4>Pr√©diction Globale Stochastique (Tendance MC)</h4>
        <p>"MC" signifie <b>Monte Carlo</b>. L'outil simule <b>100 000 sc√©narios possibles</b> pour l'√âtape 3. Chaque simulation est un "jet de d√©" bas√© sur :</p>
        <ol>
            <li><b>Votre moyenne projet√©e</b> (bas√©e sur la <b>Pente</b> de votre R√©gression Lin√©aire "Tendance").</li>
            <li><b>Votre volatilit√©</b> (votre <b>√âcart-Type</b>, ou "StdDev"). Un √©tudiant stable (faible volatilit√©) aura des simulations group√©es (ex: 88-92%). Un √©tudiant erratique (haute volatilit√©) aura des simulations dispers√©es (ex: 70-100%).</li>
        </ol>
        <p>Le score affich√© est le <b>P50 (M√©dian)</b> : le point exact o√π 50 000 simulations ont fait pire et 50 000 ont fait mieux. C'est le r√©sultat le plus probable.</p>

        <h4>Jauge de Performance (P5 √† P95)</h4>
        <p>C'est la carte compl√®te des 100 000 simulations :</p>
        <ul>
            <li><b>P5 (Pessimiste) :</b> 95 000 simulations ont donn√© un meilleur score. C'est votre "pire" sc√©nario probable.</li>
            <li><b>P50 (M√©dian) :</b> Le centre, identique √† la pr√©diction "Tendance MC".</li>
            <li><b>P95 (Optimiste) :</b> Seulement 5 000 simulations ont fait mieux. C'est le sc√©nario "r√™v√©".</li>
        </ul>

        <h4>Indices de Risque Dynamique</h4>
        <ul>
            <li><b>Indice de Consistance :</b> C'est l'inverse de votre <b>Volatilit√© (√âcart-Type)</b>. Un score de 100 signifie un √âcart-Type de 0 (ex: 90%, 90%, 90%). Un score bas signifie que vos notes sont tr√®s dispers√©es (ex: 60%, 100%, 75%).</li>
            <li><b>Risque de Burnout :</b> Score (sur 100) bas√© sur 4 facteurs : <b>1.</b> Volatilit√© (l'instabilit√© est stressante), <b>2.</b> Tendance (une pente n√©gative est un signe de difficult√©), <b>3.</b> Charge de travail (Unit√©s), <b>4.</b> Absent√©isme.</li>
            <li><b>Facteur de Tendance Globale :</b> C'est la <b>Pente (Slope)</b> de votre R√©gression "Tendance" x 10. (Ex: Pente de +0.2 = +2.0% F.T.G. = Vous gagnez 0.2 points par devoir, ou 2 points tous les 10 devoirs).</li>
        </ul>

        <h3 class="help-section-title">Analyse D√©taill√©e (Droite)</h3>

        <h4>Analyse de D√©s√©quilibre (Mismatch)</h4>
        <p>Cette section identifie les mati√®res "risqu√©es". Le "Score Mismatch" est √©lev√© si une mati√®re a :</p>
        <ul>
            <li><b>1. Une haute Volatilit√© (√âcart-Type) :</b> Vos notes sont tr√®s dispers√©es.</li>
            <li><b>2. Une faible Consistance :</b> Vos notes sont impr√©visibles.</li>
        </ul>
        <p>Une mati√®re "Rouge" (Mismatch √©lev√©) est une bombe √† retardement. C'est l√† que vous devez vous concentrer pour <b>stabiliser</b> vos r√©sultats (ex: visez des 80-90 constants plut√¥t que des 70-100 altern√©s).</p>

        <h4>Analyse de Chemin (Probabilit√©s)</h4>
        <p>Cette section vous donne un plan d'action. Elle r√©pond √† deux questions : <b>1.</b> "De quelle moyenne ai-je besoin ?" et <b>2.</b> "Quelles sont mes chances de l'obtenir ?"</p>
        <ul>
            <li><b>Moyenne Requise E2/E3 :</b> C'est un calcul alg√©brique simple pour d√©terminer la note exacte que vous devez obtenir √† l'√©tape 2 (ou 3) pour atteindre un objectif global.</li>
            <li><b>Probabilit√© (%) :</b> C'est la partie la plus importante. L'outil utilise la <b>Distribution Normale (CDF)</b>. Il compare la "Moyenne Requise" √† votre "Jauge de Performance (P5-P95)".</li>
            <li><b>Exemple :</b> Si votre "Moyenne Requise" est de <b>80%</b>, mais que votre jauge P5-P95 est entre 85% et 95%, votre probabilit√© de l'atteindre sera tr√®s √©lev√©e (ex: 99%), car 80% est en dessous de votre "pire" sc√©nario. Si la "Moyenne Requise" est de <b>96%</b>, elle est au-dessus de votre P95, donc la probabilit√© sera tr√®s faible (ex: <5%).</li>
        </ul>
    </div>
</div>

<a href="main.html" class="back-to-main-btn" title="Retour √† la page principale">
    <i class="fa-solid fa-arrow-left"></i>
</a>

<div class="main-container">

    <div class="side-panel lg:sticky lg:top-4">
        <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">Moteur Stochastique V10 (Fix)</h2>

        <div class="bg-violet-100 p-4 rounded-lg mb-4 border-l-4 border-violet-600">
            <p class="text-sm font-medium text-gray-700">Pr√©diction Globale Stochastique (Tendance MC)</p>
            <strong id="moyenne-prediction" class="text-4xl font-extrabold text-violet-700">--</strong>
        </div>

        <h3 class="text-lg font-semibold text-gray-800">Jauge de Performance (P5 √† P95)</h3>
        <div class="gauge-container">
            <div class="gauge-bar">
                <div id="gauge-needle" class="gauge-needle" style="left: 50%;"></div>
            </div>
            <div class="gauge-labels">
                <span id="gauge-label-p5">P5: --%</span>
                <strong id="gauge-label-p50" class="text-primary-color">P50: --%</strong>
                <span id="gauge-label-p95">P95: --%</span>
            </div>
        </div>
        
        <h3 class="text-lg font-semibold mt-6 mb-3 text-gray-800 border-b pb-2">Indices de Risque Dynamique</h3>
        <div id="deep-analysis-scorecard" class="space-y-3 mb-6">
            <div class="score-card score-high" id="consistency-score">
                <span class="score-icon text-gray-600">üéØ</span>
                <div>
                    <p class="text-sm font-medium text-gray-500">Indice de Consistance/Volatilit√© (100 = Parfait)</p>
                    <strong class="text-xl text-gray-800">--</strong>
                </div>
            </div>
            <div class="score-card score-low" id="burnout-risk-score">
                <span class="score-icon text-red-600">üî•</span>
                <div>
                    <p class="text-sm font-medium text-gray-500">Score de Risque de Burnout (100 = Risque Maximal pour Perte de Contr√¥le)</p>
                    <strong class="text-xl text-red-600">--</strong>
                </div>
            </div>

            <div class="ai-insight-box" id="ai-insight-container">
                <h4><span>üîé</span> Moteur de D√©couverte (IA)</h4>
                <p class="text-xs text-gray-500 -mt-2 mb-3">L'IA a scann√© vos donn√©es et a trouv√© les corr√©lations les plus fortes (R¬≤ > 0.25) :</p>
                <ul id="ai-insights-list">
                    </ul>
            </div>
            
            <div class="score-card score-low" id="dff-score">
                <span class="score-icon text-orange-600">üìâ</span>
                <div>
                    <p class="text-sm font-medium text-gray-500">Facteur de Tendance Globale (Pente / 10 devoirs)</p>
                    <strong class="text-xl text-orange-600">--</strong>
                </div>
            </div>
        </div>

        <h3 class="text-lg font-semibold mt-4 mb-2 text-gray-700 border-t pt-3">Param√®tres Actuels</h3>
        <div class="space-y-3 mb-6 text-sm">
            <div>
                <label for="niveau-secondaire" class="block text-sm font-medium text-gray-700">Niveau Secondaire</label>
                <select id="niveau-secondaire" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm py-2 px-3 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">S√©lectionner</option>
                    <option value="sec4">Secondaire 4</option>
                    <option value="sec5">Secondaire 5</option>
                </select>
            </div>
            <div>
                <label class="slider-label block text-sm font-medium text-gray-700">Taux d'Absent√©isme/D√©sengagement</label>
                <input type="range" id="absence-rate-slider" min="0" max="25" step="0.5" value="5" class="w-full mt-1">
                <p class="text-xs text-gray-500 mt-1">Impact sur B-Risk : <span id="absence-rate-value">5.0%</span></p>
            </div>

            <div>
                <label for="unites-mode" class="block text-sm font-medium text-gray-700">Mode Unit√©s (Pond√©ration)</label>
                <div class="flex space-x-2">
                    <select id="unites-mode" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm py-2 px-3 focus:ring-primary-500 focus:border-primary-500">
                        <option value="defaut">D√©faut (Officiel)</option>
                        <option value="sans">Sans Unit√©s (Moy. Simple)</option>
                        <option value="perso">Personnalis√©</option>
                    </select>
                    <button id="unites-btn" class="bg-gray-200 text-gray-600 rounded-md px-3 hover:bg-gray-300 transition duration-150 text-sm">√âditer</button>
                </div>
            </div>
        </div>

        <h3 class="text-lg font-semibold mt-4 mb-2 text-gray-700 border-t pt-3">Moyennes par Mati√®re (<span id="active-etape-name">1</span>)</h3>
        <ul id="subject-averages-list" class="space-y-2 text-base">
            </ul>

    </div>

    <div class="content-area">
        <h1 class="text-3xl font-bold mb-4 text-gray-800">D√©tails de Performance & Pr√©dictions</h1>

        <div class="flex border-b border-gray-200 mb-4">
            <button class="tab-btn active" data-tab="etape1">√âtape 1 - Analyse</button>
            <button class="tab-btn" data-tab="etape2">√âtape 2 - Analyse</button>
            <button class="tab-btn" data-tab="etape3">√âtape 3 - Projection</button>
            <button class="tab-btn" data-tab="simulation">Monte Carlo & Probabilit√©s</button>
        </div>

        <div id="tab-contents">
            <div id="etape1" class="tab-content active">
                </div>
            <div id="etape2" class="tab-content">
                </div>
            <div id="etape3" class="tab-content">
                </div>

            <div id="simulation" class="tab-content">
                <h2 class="text-2xl font-bold mb-4 text-primary-color">Analyse Pr√©dictive Stochastique (100,000 Sc√©narios)</h2>
                <p class="text-gray-600 mb-6 border-b pb-4">
                    *Le mod√®le utilise la **R√©gression Lin√©aire** pour la tendance de base et projette la performance. Les probabilit√©s sont calcul√©es √† l'aide d'une **CDF Normale** bas√©e sur la tendance et la volatilit√© (StdDev) de vos notes. Ces donn√©es sont des estimations statistiques.*
                </p>

                <h3 class="text-xl font-semibold mb-3 mt-4 text-gray-700">Pr√©dictions de Moyenne Finale Globale (Intervalles de Confiance)</h3>
                <div id="global-predictions" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
                    </div>

                <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Analyse de D√©s√©quilibre Volatilit√© / Effort (Mismatch)</h3>
                <div id="mismatch-analysis" class="space-y-4">
                    </div>

                <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Analyse de Chemin : Moyenne Requise √† l'√âtape 2</h3>
                <p class="text-sm text-gray-600 mb-4">Moyenne exacte que vous devez obtenir √† l'**√âtape 2** (bas√© sur E1 et la projection E3) pour atteindre chaque objectif global.</p>
                <table class="probability-table w-full rounded-lg overflow-hidden">
                    <thead>
                        <tr class="bg-gray-100">
                            <th>Objectif Global (%)</th>
                            <th>Moyenne Requise E2 (%)</th>
                            <th>Probabilit√© (%)</th>
                            <th>Analyse du Risque</th>
                        </tr>
                    </thead>
                    <tbody id="probability-table-body-e2">
                        </tbody>
                </table>

                <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Analyse de Chemin : Moyenne Requise √† l'√âtape 3</h3>
                <p class="text-sm text-gray-600 mb-4">Moyenne exacte que vous devez obtenir √† l'**√âtape 3** (bas√© sur E1+E2) pour atteindre chaque objectif global.</p>
                <table class="probability-table w-full rounded-lg overflow-hidden">
                    <thead>
                        <tr class="bg-gray-100">
                            <th>Objectif Global (%)</th>
                            <th>Moyenne Requise E3 (%)</th>
                            <th>Probabilit√© (%)</th>
                            <th>Analyse du Risque</th>
                        </tr>
                    </thead>
                    <tbody id="probability-table-body-e3">
                        </tbody>
                </table>

                 <h3 class="text-xl font-semibold mb-3 mt-8 text-gray-700 border-t pt-4">Pr√©dictions Tendancielles D√©taill√©es par Mati√®re</h3>
                <p class="text-sm text-gray-600 mb-4">Pr√©diction de note finale (E1+E2+E3) bas√©e sur la **Tendance par R√©gression Lin√©aire**. **Plafond√© au Max. Historique + 5%**.</p>
                <div id="subject-predictions-list" class="space-y-3">
                    </div>
            </div>
        </div>
    </div>
</div>

<div id="unites-modal" class="modal">
    <div class="modal-content">
        <h3 class="text-xl font-bold mb-4">Unit√©s par Mati√®re</h3>
        <p class="text-sm text-gray-500 mb-4">Ajustez les unit√©s pour chaque mati√®re si le mode 'Personnalis√©' est s√©lectionn√©.</p>
        <div id="unites-list" class="max-h-80 overflow-y-auto border p-3 rounded-md space-y-2">
            </div>
        <div class="mt-6 flex justify-end">
            <button id="close-unites-modal" class="bg-primary-color text-white px-4 py-2 rounded-md hover:bg-violet-700 transition">Fermer & Appliquer</button>
        </div>
    </div>
</div>

<script src="js/projected-averages.js"></script> 
<script src="js/projection.js"></script>

<script>
    // Inline script for instant theme loading
    const themeToggle = document.getElementById('theme-toggle');
    const html = document.documentElement;
    const toggleIcon = themeToggle.querySelector('i');
    const THEME_KEY = 'mbs-theme'; // Using the same key as improve.html

    const updateTheme = (theme) => {
        html.setAttribute('data-theme', theme);
        localStorage.setItem(THEME_KEY, theme);
        toggleIcon.className = theme === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
    };

    const storedTheme = localStorage.getItem(THEME_KEY);
    const initialTheme = storedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    updateTheme(initialTheme);

    themeToggle.addEventListener('click', () => {
        const newTheme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        updateTheme(newTheme);
    });
</script>

</body>
</html>
