<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur Dynamique V10 (Pathfinder V2)</title>
    <!-- Tailwind is kept for layout, but styles will be overridden by the new theme -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Google Fonts for the new theme -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- NEW THEME --- */
        :root {
            --primary-color: #2980b9; --secondary-color: #2c3e50; --background-color: #f7f9fb; --widget-background: #ffffff; --text-color: #34495e; --text-secondary-color: #7f8c8d; --accent-color: #3498db; --light-grey: #e0e6eb; --footer-grey: #7f8c8d; --success-color: #27ae60; --danger-color: #e74c3c; --warning-color: #f39c12; --shadow-header: 0 2px 4px rgba(0,0,0,0.05); --shadow-widget: 0 8px 15px rgba(0,0,0,0.08); --border-color: #e0e6eb; --goal-success-bg: #eafaf1; --goal-warning-bg: #fff9f0; --goal-danger-bg: #fdf3f2; --transition-duration: 0.35s;
        }

        [data-theme="dark"] {
            --background-color: #121212; --widget-background: #1e1e1e; --text-color: #e0e0e0; --text-secondary-color: #a0a0a0; --secondary-color: #bbbbbb; --light-grey: #333333; --footer-grey: #a0a0a0; --shadow-header: 0 2px 5px rgba(255,255,255,0.1); --shadow-widget: 0 5px 10px rgba(0,0,0,0.3); --border-color: #333333; --goal-success-bg: #1a3e2a; --goal-warning-bg: #4d381c; --goal-danger-bg: #4f2323;
        }

        /* --- General Styles & Transitions --- */
        body, .side-panel, .tab-content, .modal-content, .tab-btn, .prediction-card {
            transition: background-color var(--transition-duration) ease, color var(--transition-duration) ease, border-color var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
        }
        body { 
            margin: 0; 
            font-family: 'Inter', sans-serif; 
            background-color: var(--background-color); 
            color: var(--text-color); 
        }

        /* --- Page Layout --- */
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* --- Header / Fixed Buttons --- */
        .page-header {
            padding: 20px 25px;
            text-align: center;
            margin-bottom: 20px;
        }
        .page-header h1 {
            color: var(--secondary-color);
            font-size: 2.5em; /* Larger, more impactful title */
            font-family: 'Playfair Display', serif;
            margin: 0;
        }
        [data-theme="dark"] .page-header h1 {
            color: var(--text-color);
        }

        .icon-btn {
            position: fixed;
            top: 20px;
            background: var(--widget-background);
            border: 2px solid var(--light-grey);
            color: var(--text-color);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            text-decoration: none;
            transition: all 0.2s ease;
            z-index: 1000;
            box-shadow: var(--shadow-header);
        }
        .icon-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: scale(1.1);
        }
        #back-btn { left: 20px; }
        #theme-toggle { right: 20px; }
        #open-help-btn { right: 80px; }
        
        /* --- Tabs --- */
        .sticky-tabs {
            position: sticky;
            top: 0;
            background-color: var(--background-color);
            z-index: 100;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        .tab-btn {
            padding: 10px 20px;
            border: 1px solid var(--light-grey);
            border-radius: 20px; /* Pill shape */
            background-color: transparent;
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9em;
        }
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* --- Side Panel & Content Area --- */
        .side-panel, .tab-content {
            background-color: var(--widget-background);
            border-radius: 12px;
            box-shadow: var(--shadow-widget);
            padding: 25px;
        }
        .side-panel h2, .content-area h2, .side-panel h3, .content-area h3 {
            font-family: 'Playfair Display', serif;
            color: var(--secondary-color);
        }
        [data-theme="dark"] .side-panel h2, [data-theme="dark"] .content-area h2, [data-theme="dark"] .side-panel h3, [data-theme="dark"] .content-area h3 {
            color: var(--text-color);
        }

        /* --- Widget & Card Styling --- */
        .prediction-card, .score-card, .ai-insight-box {
            background-color: #fdfdfd; /* Slightly off-white for depth */
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .prediction-card:hover, .score-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0,0,0,0.1);
        }
        .prediction-card { border-left-width: 5px; }
        .card-green { border-left-color: var(--success-color); }
        .card-violet { border-left-color: var(--primary-color); }
        .card-yellow { border-left-color: var(--warning-color); }
        .card-red { border-left-color: var(--danger-color); }

        [data-theme="dark"] .prediction-card, [data-theme="dark"] .score-card, [data-theme="dark"] .ai-insight-box {
             background-color: #282828; /* Lighter dark grey for cards */
        }

        /* --- Specific Component Theming --- */
        #moyenne-prediction { color: var(--primary-color); }
        .gauge-bar { background: linear-gradient(90deg, var(--danger-color), var(--warning-color), var(--success-color)); }
        .gauge-needle { background-color: var(--secondary-color); border: 2px solid white; }
        [data-theme="dark"] .gauge-needle { background-color: var(--text-color); }
        
        .ai-insight-box { background-color: var(--goal-success-bg); border-color: var(--success-color); }
        .ai-insight-box h4 { color: var(--success-color); }
        [data-theme="dark"] .ai-insight-box { background-color: var(--goal-success-bg); border-color: var(--success-color); }

        /* Tables */
        .subject-table, .probability-table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: none;
            border: 1px solid var(--border-color);
        }
        .subject-table thead th, .probability-table thead th {
             background-color: #f7f9fb; /* Match body background */
             border-bottom: 2px solid var(--border-color);
             color: var(--text-secondary-color);
             text-transform: uppercase;
             font-size: 0.8em;
             font-weight: 700;
        }
        .subject-table td, .probability-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .subject-table tbody tr:last-child td, .probability-table tbody tr:last-child td {
            border-bottom: none;
        }
        [data-theme="dark"] .subject-table thead th, [data-theme="dark"] .probability-table thead th {
            background-color: #282828;
        }
        
        /* Badges & Probabilities */
        .prob-high { background-color: var(--goal-success-bg); color: var(--success-color); font-weight: 600; }
        .prob-medium { background-color: var(--goal-warning-bg); color: var(--warning-color); font-weight: 600; }
        .prob-low { background-color: var(--goal-danger-bg); color: var(--danger-color); font-weight: 600; }
        
        /* Modal Styling */
        .modal { background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); }
        .modal-content { background-color: var(--background-color); border: 1px solid var(--border-color); }
        .modal-close { color: var(--text-secondary-color); }

        /* Remove old fixed buttons */
        body > .help-btn, body > .back-to-main-btn { display: none; }
    </style>
</head>
<body>

<!-- New Header Buttons -->
<a href="improve.html" id="back-btn" class="icon-btn" title="Retour √† la page principale">
    <i class="fa-solid fa-arrow-left"></i>
</a>
<button id="theme-toggle" class="icon-btn" title="Changer de th√®me">
    <i class="fa-solid fa-moon"></i>
</button>
<button id="open-help-btn" class="icon-btn" title="Comment √ßa marche ?">
    <i class="fa-solid fa-question"></i>
</button>

<!-- Main Page Structure -->
<div class="page-header">
    <h1 class="">Analyseur Dynamique</h1>
</div>

<div class="sticky-tabs">
    <button class="tab-btn active" data-tab="etape1">√âtape 1 - Analyse</button>
    <button class="tab-btn" data-tab="etape2">√âtape 2 - Analyse</button>
    <button class="tab-btn" data-tab="etape3">√âtape 3 - Projection</button>
    <button class="tab-btn" data-tab="simulation">Monte Carlo & Probabilit√©s</button>
</div>

<div class="main-container">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Side Panel (Now first column) -->
        <div class="side-panel lg:col-span-1 lg:sticky lg:top-24 h-fit">
            <h2 class="text-2xl font-bold mb-4 border-b pb-2">Moteur Stochastique</h2>

            <div class="bg-violet-100 p-4 rounded-lg mb-4 border-l-4 border-violet-600" style="background-color: #eaf2f8; border-color: var(--primary-color);">
                <p class="text-sm font-medium text-gray-700">Pr√©diction Globale (Tendance MC)</p>
                <strong id="moyenne-prediction" class="text-4xl font-extrabold">--</strong>
            </div>

            <h3 class="text-lg font-semibold text-gray-800">Jauge de Performance (P5 √† P95)</h3>
            <div class="gauge-container">
                <div class="gauge-bar">
                    <div id="gauge-needle" class="gauge-needle" style="left: 50%;"></div>
                </div>
                <div class="gauge-labels">
                    <span id="gauge-label-p5">P5: --%</span>
                    <strong id="gauge-label-p50" style="color: var(--primary-color);">P50: --%</strong>
                    <span id="gauge-label-p95">P95: --%</span>
                </div>
            </div>
            
            <h3 class="text-lg font-semibold mt-6 mb-3 border-b pb-2">Indices de Risque</h3>
            <div id="deep-analysis-scorecard" class="space-y-3 mb-6">
                <div class="score-card" id="consistency-score">
                    <div class="flex items-center">
                        <span class="score-icon text-2xl mr-4">üéØ</span>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Indice de Consistance</p>
                            <strong class="text-xl">--</strong>
                        </div>
                    </div>
                </div>
                <div class="score-card" id="burnout-risk-score">
                    <div class="flex items-center">
                        <span class="score-icon text-2xl mr-4">üî•</span>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Risque de Burnout</p>
                            <strong class="text-xl text-red-600">--</strong>
                        </div>
                    </div>
                </div>
                 <div class="score-card" id="dff-score">
                    <div class="flex items-center">
                         <span class="score-icon text-2xl mr-4">üìâ</span>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Facteur Tendance Global</p>
                            <strong class="text-xl text-orange-600">--</strong>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="ai-insight-box" id="ai-insight-container">
                <h4 class="flex items-center font-bold text-lg mb-2"><span>üîé</span> Moteur de D√©couverte (IA)</h4>
                <ul id="ai-insights-list" class="space-y-1"></ul>
            </div>
        </div>

        <!-- Content Area (Now second/third column) -->
        <div class="content-area lg:col-span-2">
            <div id="tab-contents">
                <div id="etape1" class="tab-content active"></div>
                <div id="etape2" class="tab-content"></div>
                <div id="etape3" class="tab-content"></div>

                <div id="simulation" class="tab-content">
                    <h2 class="text-2xl font-bold mb-4">Analyse Pr√©dictive Stochastique</h2>
                    <p class="text-gray-600 mb-6 border-b pb-4">Le mod√®le utilise la R√©gression Lin√©aire pour projeter la performance. Les probabilit√©s sont calcul√©es via une CDF Normale bas√©e sur la tendance et la volatilit√© de vos notes.</p>

                    <h3 class="text-xl font-semibold mb-3 mt-4">Pr√©dictions de Moyenne Finale</h3>
                    <div id="global-predictions" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"></div>

                    <h3 class="text-xl font-semibold mb-3 mt-8 border-t pt-4">Analyse de D√©s√©quilibre (Mismatch)</h3>
                    <div id="mismatch-analysis" class="space-y-4"></div>

                    <h3 class="text-xl font-semibold mb-3 mt-8 border-t pt-4">Chemin vers Objectif (via √âtape 2)</h3>
                    <table class="probability-table w-full rounded-lg overflow-hidden">
                        <thead><tr><th>Objectif</th><th>Requis E2</th><th>Probabilit√©</th><th>Analyse</th></tr></thead>
                        <tbody id="probability-table-body-e2"></tbody>
                    </table>

                    <h3 class="text-xl font-semibold mb-3 mt-8 border-t pt-4">Chemin vers Objectif (via √âtape 3)</h3>
                    <table class="probability-table w-full rounded-lg overflow-hidden">
                        <thead><tr><th>Objectif</th><th>Requis E3</th><th>Probabilit√©</th><th>Analyse</th></tr></thead>
                        <tbody id="probability-table-body-e3"></tbody>
                    </table>

                    <h3 class="text-xl font-semibold mb-3 mt-8 border-t pt-4">Pr√©dictions par Mati√®re</h3>
                    <div id="subject-predictions-list" class="space-y-3"></div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Modal remains functionally the same, but inherits new styles -->
<div id="help-modal" class="modal">
    <div class="modal-content">
        <span id="close-help-modal" class="modal-close cursor-pointer absolute top-4 right-6 text-3xl">&times;</span>
        <h2 class="help-title text-2xl font-bold mb-4" style="color: var(--primary-color);">Guide de l'Analyseur</h2>
        <p>Cet outil analyse votre <b>tendance</b> (√©lan) et votre <b>volatilit√©</b> (stabilit√©) pour pr√©dire vos performances.</p>
        <h3 class="help-section-title text-xl font-semibold mt-6 border-b-2 pb-2 mb-4" style="border-color: var(--primary-color);">La R√©gression Lin√©aire (Le C≈ìur de l'IA)</h3>
        <h4>Qu'est-ce que c'est ?</h4>
        <p>Le moteur de d√©couverte utilise la <b>R√©gression Lin√©aire</b> pour trouver la "ligne de tendance" qui passe au milieu de vos notes. L'IA analyse 3 relations distinctes :</p>
        <ol class="detailed-list list-decimal pl-5 space-y-4 mt-4">
            <li><b>TENDANCE (Note vs. Temps)</b>
                <ul class="list-disc pl-5 font-normal"><li><b>Analyse :</b> Est-ce que vos notes montent ou baissent avec le temps ?</li></ul>
            </li>
            <li><b>FOCUS (Note vs. Pond√©ration du Devoir)</b>
                <ul class="list-disc pl-5 font-normal"><li><b>Analyse :</b> R√©ussissez-vous mieux les petits devoirs ou les gros examens ?</li></ul>
            </li>
            <li><b>PRIORIT√â (Note vs. Pond√©ration de la Comp√©tence)</b>
                <ul class="list-disc pl-5 font-normal"><li><b>Analyse :</b> √ätes-vous meilleur dans les comp√©tences mineures ou majeures ?</li></ul>
            </li>
        </ol>
    </div>
</div>

<!-- Scripts remain the same -->
<script src="js/projected-averages.js"></script> 
<script src="js/projection.js"></script>

<script>
    // Theme toggling script
    const themeToggle = document.getElementById('theme-toggle');
    const helpBtn = document.getElementById('open-help-btn');
    const helpModal = document.getElementById('help-modal');
    const closeHelpModal = document.getElementById('close-help-modal');

    const html = document.documentElement;
    const toggleIcon = themeToggle.querySelector('i');
    const THEME_KEY = 'mbs-theme';

    const updateTheme = (theme) => {
        html.setAttribute('data-theme', theme);
        localStorage.setItem(THEME_KEY, theme);
        toggleIcon.className = theme === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
    };

    const storedTheme = localStorage.getItem(THEME_KEY);
    const initialTheme = storedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    updateTheme(initialTheme);

    themeToggle.addEventListener('click', () => {
        const newTheme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        updateTheme(newTheme);
    });

    // Tab functionality
    const tabs = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(item => item.classList.remove('active'));
            tab.classList.add('active');
            const target = tab.getAttribute('data-tab');
            tabContents.forEach(content => {
                content.style.display = content.id === target ? 'block' : 'none';
            });
        });
    });
     // Manually trigger click on the first tab to show its content initially
    document.querySelector('.tab-btn[data-tab="simulation"]').click();
    document.querySelector('.tab-btn[data-tab="etape1"]').click();

    // Help Modal Functionality
    helpBtn.addEventListener('click', () => helpModal.classList.add('active', 'flex'));
    closeHelpModal.addEventListener('click', () => helpModal.classList.remove('active', 'flex'));
    window.addEventListener('click', (event) => {
        if (event.target === helpModal) {
            helpModal.classList.remove('active', 'flex');
        }
    });
</script>

</body>
</html>
